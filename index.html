<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>1o1.run â€¢ Type. Fetch. Done.</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="robots" content="noindex,nofollow">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
  <style>
    body, html { margin:0; padding:0; width:100%; height:100%; background:#1e1e1e; overflow:hidden; }
    #terminal { width:100%; height:100%; }
  </style>
</head>
<body>
  <div id="terminal"></div>

  <!-- xterm.js + fit addon -->
  <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js"></script>

  <script type="module">
    import { weather }  from './commands/weather.js';
    import { news }     from './commands/news.js';
    import { stocks }   from './commands/stocks.js';
    import { currency } from './commands/currency.js';

    const weatherCodes = {
      0:['â˜€ï¸','Clear'],1:['ðŸŒ¤','Mainly clear'],2:['â›…','Partly cloudy'],3:['â˜ï¸','Overcast'],
      45:['ðŸŒ«','Fog'],48:['ðŸŒ«','Rime fog'],51:['ðŸŒ¦','Light drizzle'],53:['ðŸŒ¦','Moderate drizzle'],
      55:['ðŸŒ§','Dense drizzle'],61:['ðŸŒ§','Light rain'],63:['ðŸŒ§','Moderate rain'],65:['ðŸŒ§','Heavy rain'],
      71:['â„ï¸','Light snow'],73:['â„ï¸','Moderate snow'],75:['â„ï¸','Heavy snow'],
      80:['ðŸŒ¦','Showers'],81:['ðŸŒ§','Heavy showers'],82:['ðŸŒ§','Violent showers'],
      95:['â›ˆ','Thunderstorm'],96:['â›ˆ','Thunder w/ hail'],99:['â›…','Storm']
    };

    // initialize terminal with clean theme
    const term = new Terminal({
      cursorBlink: true,
      wrapAroundMode: true,
      theme: {
        background:   '#1e1e1e', foreground: '#c5c8c6', cursor: '#aeafad',
        black: '#1e1e1e', red: '#cc342b', green: '#198844', yellow: '#fba922',
        blue: '#3971ed', magenta: '#a36ac7', cyan: '#3971ed', white: '#c5c8c6',
        brightBlack:'#969896', brightRed:'#cc342b', brightGreen:'#198844',
        brightYellow:'#fba922', brightBlue:'#3971ed', brightMagenta:'#a36ac7',
        brightCyan:'#3971ed', brightWhite:'#ffffff'
      }
    });
    const fit = new FitAddon.FitAddon();
    term.loadAddon(fit);
    term.open(document.getElementById('terminal'));
    fit.fit();
    window.addEventListener('resize', () => fit.fit());

    let buffer = '';
    const prompt = () => term.write('\r\n\x1b[1;32m1o1>\x1b[0m ');
    term.write('\x1b[1;32m1o1>\x1b[0m ');

    term.onKey(async ({ key, domEvent }) => {
      if (domEvent.keyCode === 13) {
        const line = buffer.trim(); buffer = '';
        await runCommand(line);
        prompt();
      } else if (domEvent.keyCode === 8 && buffer.length) {
        term.write('\b \b');
        buffer = buffer.slice(0, -1);
      } else if (!domEvent.ctrlKey && !domEvent.metaKey && key.length === 1) {
        term.write(key);
        buffer += key;
      }
    });

    async function runCommand(line) {
      if (!line) return;
      const [cmd, ...parts] = line.split(' ');
      const arg = parts.join(' ');
      switch (cmd) {
        case 'help':    return help();
        case 'about':   return about();
        case 'clear':   return term.clear();
        case 'weather': return weather(term, arg, weatherCodes);
        case 'news':    return news(term, arg);
        case 'stocks':  return stocks(term, arg);
        case 'currency':return currency(term, arg);
        default:
          return term.writeln('\x1b[1;31mUnknown command:\x1b[0m ' + cmd);
      }
    }

    function help() {
      term.writeln('\x1b[1;36mCommands:\x1b[0m');
      [
        'weather <location>',
        'news [keyword | read N]',
        'stocks <symbol>',
        'currency <BASE>-<QUOTE>',
        'clear',
        'help',
        'about'
      ].forEach(line => term.writeln(' â€¢ ' + line));
    }

    function about() {
      term.writeln('\x1b[1;33m1o1.run â€” type. fetch. done.\x1b[0m');
      term.writeln('Stateless IPFS-hosted web shell. Open-source on GitHub.');
    }
  </script>
</body>
</html>
